<Window xmlns:platformui="clr-namespace:Microsoft.VisualStudio.PlatformUI;assembly=Microsoft.VisualStudio.Shell.15.0"
        xmlns:theme="clr-namespace:Community.VisualStudio.Toolkit"
        xmlns:imaging="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.Imaging"
        xmlns:catalog="clr-namespace:Microsoft.VisualStudio.Imaging;assembly=Microsoft.VisualStudio.ImageCatalog"
        xmlns:vsshell="clr-namespace:Microsoft.VisualStudio.Shell;assembly=Microsoft.VisualStudio.Shell.15.0"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
               xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
               x:Class="Cody.UI.Views.ToastView"
               Height="105"
               Width="350"
               WindowStyle="None"
               BorderThickness="1"
               BorderBrush="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowBorderKey}}"
               WindowStartupLocation="Manual"
               ResizeMode="NoResize"
               AllowsTransparency="True"
               ShowInTaskbar="False"
               SizeToContent="Height"
               theme:Themes.UseVsTheme="True"
               >
    <FrameworkElement.Resources>
        <Style x:Key="IgnoreButtonStyle" TargetType="{x:Type Button}">
            <Setter Property="Control.BorderThickness" Value="0"/>
            <Setter Property="Control.HorizontalContentAlignment" Value="Center"/>
            <Setter Property="Control.VerticalContentAlignment" Value="Center"/>
            <Setter Property="FrameworkElement.UseLayoutRounding" Value="True"/>
            <Setter Property="Template">
                <Setter.Value>
                    <ControlTemplate TargetType="{x:Type Button}">
                        <Border Background="{TemplateBinding Background}" BorderThickness="{TemplateBinding BorderThickness}" BorderBrush="{TemplateBinding BorderBrush}">
                            <ContentPresenter HorizontalAlignment="Center" VerticalAlignment="Center" />
                        </Border>
                    </ControlTemplate>
                </Setter.Value>
            </Setter>
            <Style.Triggers>
                <Trigger Property="IsMouseOver" Value="True">
                    <Setter Property="BorderBrush" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowButtonHoverInactiveBorderKey}}"/>
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowButtonHoverInactiveGlyphKey}}"/>
                    <Setter Property="Background" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowButtonHoverInactiveKey}}"/>
                    <Setter Property="BorderThickness" Value="1"/>
                </Trigger>
                <Trigger Property="IsMouseOver" Value="False">
                    <Setter Property="BorderThickness" Value="0"/>
                    <Setter Property="Foreground" Value="{DynamicResource {x:Static vsshell:VsBrushes.ToolWindowButtonInactiveGlyphKey}}"/>
                    <Setter Property="Background" Value="Transparent"/>
                </Trigger>
            </Style.Triggers>
        </Style>
        <Style x:Key="DismissGlyphStyleKey" TargetType="{x:Type Path}">
            <Setter Property="Shape.Fill">
                <Setter.Value>
                    <Binding Path="(TextElement.Foreground)" RelativeSource="{RelativeSource Self}"/>
                </Setter.Value>
            </Setter>
            <Setter Property="FrameworkElement.Height" Value="10"/>
            <Setter Property="FrameworkElement.Width" Value="10"/>
            <Setter Property="Shape.Stretch" Value="Uniform"/>
        </Style>
        <Path x:Key="DismissGlyphPathKey" x:Name="DismissGlyph" x:Uid="DismissGlyph"
          Data="F1 M 0,0 L 2,0 5,3 8,0 10,0 6,4 10,8 8,8 5,5 2,8 0,8 4,4 0,0 Z"
          Style="{StaticResource DismissGlyphStyleKey}"/>
    </FrameworkElement.Resources>
    <StackPanel Margin="12">
        <Grid>
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="32"/>
                <ColumnDefinition Width="*"/>
                <ColumnDefinition Width="Auto"/>
            </Grid.ColumnDefinitions>

            <imaging:CrispImage Grid.Column="0"
                                Width="24"
                                Height="24"
                                Margin="2,2,0,0"
                                VerticalAlignment="Top"
                                Moniker="{Binding Moniker}"/>


            <StackPanel Grid.Column="1"
                        Margin="8,0,20,0"
                        Orientation="Vertical"
                        VerticalAlignment="Top"
                        HorizontalAlignment="Left">
                <TextBlock Margin="0,0,0,8" FontWeight="SemiBold" Text="{Binding Message}" TextWrapping="Wrap" Visibility="Visible">
                </TextBlock>
                <TextBlock Margin="0" Text="{Binding Details}" TextWrapping="Wrap">
                    <TextBlock.Style>
                        <Style TargetType="TextBlock">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding Details}" Value="{x:Null}">
                                    <Setter Property="Visibility" Value="Collapsed"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </TextBlock.Style>
                </TextBlock>
            </StackPanel>

            <Button Grid.Column="2"
                    Width="14"
                    Height="14"
                    Margin="0,-6,-6,0"
                    HorizontalAlignment="Right"
                    VerticalAlignment="Top"
                    IsCancel="True"
                    Focusable="False"
                    Command="{Binding CloseCommand}"
                    Style="{StaticResource IgnoreButtonStyle}">
                <StaticResourceExtension ResourceKey="DismissGlyphPathKey"/>
            </Button>
            
        </Grid>
        <StackPanel x:Name="ActionButtonPanel" Margin="46,17,0,0" HorizontalAlignment="Right" Orientation="Horizontal">
            <ItemsControl ItemsSource="{Binding Actions}">
                <ItemsControl.ItemsPanel>
                    <ItemsPanelTemplate>
                        <StackPanel Orientation="Horizontal"/>
                    </ItemsPanelTemplate>
                </ItemsControl.ItemsPanel>
                <ItemsControl.ItemTemplate>
                    <DataTemplate>
                        <Button Margin="0,0,6,0"
                                Content="{Binding}"
                                Command="{Binding DataContext.ActionCommand, RelativeSource={RelativeSource AncestorType=ItemsControl}}"
                                CommandParameter="{Binding}"/>
                    </DataTemplate>
                </ItemsControl.ItemTemplate>
            </ItemsControl>
        </StackPanel>
    </StackPanel>
</Window>
